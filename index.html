<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANTI RUB - –°—Ç–µ–π–∫–∏–Ω–≥ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --accent: #4ade80;
            --dark: #0a0a0a;
            --gray: #888;
            --red: #ef4444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--dark);
            color: #fff;
            line-height: 1.6;
        }
        
        .bg-animated {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            opacity: 0.05;
        }
        
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 20px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .logo-text {
            font-size: 1.8em;
            font-weight: bold;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .nav-right {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .connect-btn {
            padding: 12px 30px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }
        
        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102,126,234,0.5);
        }
        
        .connect-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .wallet-info {
            display: none;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
            background: rgba(255,255,255,0.05);
            padding: 10px 20px;
            border-radius: 15px;
            border: 2px solid var(--primary);
        }
        
        .wallet-info.connected {
            display: flex;
        }
        
        .wallet-address {
            font-size: 0.95em;
            color: var(--accent);
            font-weight: 600;
        }
        
        .wallet-balance {
            font-size: 0.85em;
            color: var(--gray);
        }
        
        .network-badge {
            font-size: 0.8em;
            color: var(--accent);
            background: rgba(74,222,128,0.1);
            padding: 3px 10px;
            border-radius: 10px;
            margin-top: 5px;
        }
        
        .container {
            max-width: 1400px;
            margin: 120px auto 50px;
            padding: 20px;
        }
        
        .hero-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(102,126,234,0.3);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.3s;
            text-align: center;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 15px 40px rgba(102,126,234,0.3);
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(45deg, var(--accent), #22c55e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .rate-card {
            background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));
            border: 2px solid var(--primary);
        }
        
        .rate-value {
            font-size: 3em;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .rate-timestamp {
            font-size: 0.8em;
            color: var(--gray);
            margin-top: 5px;
        }
        
        .section {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(102,126,234,0.3);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 2em;
            margin-bottom: 30px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }
        
        .dashboard-card {
            background: rgba(255,255,255,0.03);
            border: 2px solid rgba(102,126,234,0.2);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-3px);
            border-color: var(--accent);
        }
        
        .dashboard-card h3 {
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .card-value {
            font-size: 2em;
            font-weight: bold;
            color: white;
            margin: 10px 0;
        }
        
        .card-label {
            color: var(--gray);
            font-size: 0.9em;
        }
        
        .input-group {
            margin: 25px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--gray);
        }
        
        .input-wrapper {
            position: relative;
        }
        
        .input-group input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(102,126,234,0.3);
            border-radius: 15px;
            color: white;
            font-size: 1.1em;
            transition: all 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(102,126,234,0.3);
        }
        
        .max-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            padding: 8px 15px;
            background: var(--primary);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 0.85em;
        }
        
        .btn {
            padding: 15px 40px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1em;
            border: none;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102,126,234,0.5);
        }
        
        .btn-success {
            background: var(--accent);
            color: white;
        }
        
        .btn-success:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(74,222,128,0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .info-box {
            background: rgba(102,126,234,0.1);
            border-left: 4px solid var(--primary);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .info-box.warning {
            background: rgba(239,68,68,0.1);
            border-left-color: var(--red);
        }
        
        .info-box.success {
            background: rgba(74,222,128,0.1);
            border-left-color: var(--accent);
        }
        
        .notification {
            position: fixed;
            top: 100px;
            right: 30px;
            padding: 20px 30px;
            background: rgba(10,10,10,0.95);
            border: 2px solid var(--primary);
            border-radius: 15px;
            color: white;
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 2000;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            border-color: var(--red);
        }
        
        .notification.success {
            border-color: var(--accent);
        }
        
        footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: 60px;
        }
        
        @media (max-width: 768px) {
            nav {
                padding: 15px 20px;
                flex-wrap: wrap;
            }
            
            .container {
                margin-top: 180px;
                padding: 15px;
            }
            
            .hero-stats, .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animated"></div>
    
    <div id="notification" class="notification"></div>
    
    <nav>
        <div class="logo">
            <div class="logo-icon">‚í∂</div>
            <div class="logo-text">ANTI RUB</div>
        </div>
        
        <div class="nav-right">
            <button id="connectBtn" class="connect-btn" onclick="connectWallet()">
                –ü–æ–¥–∫–ª—é—á–∏—Ç—å MetaMask
            </button>
            
            <div id="walletInfo" class="wallet-info">
                <span id="walletAddress" class="wallet-address"></span>
                <span id="walletBalance" class="wallet-balance"></span>
                <span id="networkBadge" class="network-badge"></span>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="hero-stats">
            <div class="stat-card rate-card">
                <div class="stat-label">–ö—É—Ä—Å USDT/RUB</div>
                <div class="rate-value" id="usdtRubRate">--</div>
                <div class="rate-timestamp" id="rateTimestamp">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Total Supply</div>
                <div class="stat-value">1,000M</div>
                <div class="card-label">ARUB Tokens</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">–°—Ç–µ–π–∫–∏–Ω–≥ APR</div>
                <div class="stat-value">120%</div>
                <div style="color: var(--accent); margin-top: 10px;">‚Üë –í—ã—Å–æ–∫–∏–π –¥–æ—Ö–æ–¥</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">–í—Å–µ–≥–æ –∑–∞—Å—Ç–µ–π–∫–∞–Ω–æ</div>
                <div class="stat-value" id="totalStaked">0</div>
                <div class="card-label">ARUB</div>
            </div>
        </div>
        
        <div class="section">
            <h2 class="section-title">üìä Dashboard</h2>
            
            <div class="info-box warning" id="connectWarning">
                <strong>‚ö†Ô∏è –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫</strong>
                <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–∫–ª—é—á–∏—Ç—å MetaMask" –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º —Å—Ç–µ–π–∫–∏–Ω–≥–∞</p>
            </div>
            
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>üíº –í–∞—à –±–∞–ª–∞–Ω—Å</h3>
                    <div class="card-value" id="userBalance">0.00</div>
                    <div class="card-label">ARUB Tokens</div>
                </div>
                
                <div class="dashboard-card">
                    <h3>üíµ –°—Ç–æ–∏–º–æ—Å—Ç—å USD</h3>
                    <div class="card-value" id="usdValue">$0.00</div>
                    <div class="card-label">–ü–æ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω–µ</div>
                </div>
                
                <div class="dashboard-card">
                    <h3>üè¶ –ó–∞—Å—Ç–µ–π–∫–∞–Ω–æ</h3>
                    <div class="card-value" id="stakedAmount">0.00</div>
                    <div class="card-label">ARUB</div>
                </div>
                
                <div class="dashboard-card">
                    <h3>üíé –ù–∞–≥—Ä–∞–¥—ã</h3>
                    <div class="card-value" id="rewardsEarned">0.00</div>
                    <div class="card-label">ARUB</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2 class="section-title">‚ö° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–µ–π–∫–∏–Ω–≥–æ–º</h2>
            
            <div class="input-group">
                <label for="stakeAmount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤:</label>
                <div class="input-wrapper">
                    <input 
                        type="number" 
                        id="stakeAmount" 
                        placeholder="0.0" 
                        min="0"
                        step="0.01"
                    >
                    <button class="max-btn" onclick="setMaxAmount()">MAX</button>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="testApprove()">
                    1. Approve (Test)
                </button>
                <button class="btn btn-success" onclick="testStake()">
                    2. Stake (Test)
                </button>
                <button class="btn btn-primary" onclick="testUnstake()">
                    Unstake (Test)
                </button>
                <button class="btn btn-success" onclick="testClaim()">
                    Claim (Test)
                </button>
            </div>
            
            <div class="info-box">
                <strong>‚ÑπÔ∏è –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º</strong>
                <p>–°–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ. –ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è MetaMask –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å–≤–æ–π –∞–¥—Ä–µ—Å –∏ –±–∞–ª–∞–Ω—Å ETH. 
                –ö–Ω–æ–ø–∫–∏ —Å—Ç–µ–π–∫–∏–Ω–≥–∞ —Å–∏–º—É–ª–∏—Ä—É—é—Ç –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.</p>
            </div>
        </div>
        
        <div class="section">
            <h2 class="section-title">üèÜ –£—Ä–æ–≤–Ω–∏ —Å—Ç–µ–π–∫–∏–Ω–≥–∞</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div class="dashboard-card" style="text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 10px;">ü•â</div>
                    <h3>Bronze</h3>
                    <div class="card-value" style="font-size: 1.5em; color: var(--accent);">100%</div>
                    <div class="card-label">100 - 999 ARUB</div>
                </div>
                
                <div class="dashboard-card" style="text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 10px;">ü•à</div>
                    <h3>Silver</h3>
                    <div class="card-value" style="font-size: 1.5em; color: var(--accent);">110%</div>
                    <div class="card-label">1K - 9,999 ARUB</div>
                </div>
                
                <div class="dashboard-card" style="text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 10px;">ü•á</div>
                    <h3>Gold</h3>
                    <div class="card-value" style="font-size: 1.5em; color: var(--accent);">120%</div>
                    <div class="card-label">10K - 99,999 ARUB</div>
                </div>
                
                <div class="dashboard-card" style="text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 10px;">üíé</div>
                    <h3>Platinum</h3>
                    <div class="card-value" style="font-size: 1.5em; color: var(--accent);">130%</div>
                    <div class="card-label">100K+ ARUB</div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>¬© 2025 ANTI RUB. –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–≤–∞–ª—å–≤–∞—Ü–∏–∏ —Ä—É–±–ª—è —á–µ—Ä–µ–∑ DeFi</p>
        <p style="margin-top: 10px; font-size: 0.9em;">
            ‚ö†Ô∏è –¢–µ—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è. –ù–µ —è–≤–ª—è–µ—Ç—Å—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–µ–π.
        </p>
    </footer>
    
    <script>
        let provider;
        let signer;
        let userAddress;
        let isConnected = false;
        
        // ==========================================
        // USDT/RUB RATE
        // ==========================================
        async function fetchUsdtRubRate() {
            try {
                const response = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=USDTRUB');
                const data = await response.json();
                
                if (data.price) {
                    const rate = parseFloat(data.price).toFixed(2);
                    document.getElementById('usdtRubRate').textContent = rate + ' ‚ÇΩ';
                    
                    const now = new Date();
                    const timeStr = now.toLocaleTimeString('ru-RU');
                    document.getElementById('rateTimestamp').textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${timeStr}`;
                    
                    return parseFloat(rate);
                }
            } catch (error) {
                console.error('Error fetching rate:', error);
                document.getElementById('usdtRubRate').textContent = '95.50 ‚ÇΩ';
                document.getElementById('rateTimestamp').textContent = '–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ';
            }
        }
        
        setInterval(fetchUsdtRubRate, 30000);
        
        // ==========================================
        // WALLET CONNECTION
        // ==========================================
        async function connectWallet() {
            const btn = document.getElementById('connectBtn');
            btn.disabled = true;
            btn.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
            
            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è MetaMask
                if (typeof window.ethereum === 'undefined') {
                    showNotification('‚ùå MetaMask –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å metamask.io', 'error');
                    window.open('https://metamask.io/download/', '_blank');
                    btn.disabled = false;
                    btn.textContent = '–ü–æ–¥–∫–ª—é—á–∏—Ç—å MetaMask';
                    return;
                }
                
                console.log('MetaMask –æ–±–Ω–∞—Ä—É–∂–µ–Ω, –∑–∞–ø—Ä–æ—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...');
                
                // –ö–†–ò–¢–ò–ß–ù–û: –ó–∞–ø—Ä–æ—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MetaMask
                // –≠—Ç–æ—Ç –≤—ã–∑–æ–≤ –æ—Ç–∫—Ä–æ–µ—Ç popup MetaMask –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                if (!accounts || accounts.length === 0) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç—ã. –†–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ MetaMask.');
                }
                
                console.log('–ê–∫–∫–∞—É–Ω—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã:', accounts);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ethers.js
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                
                console.log('–ê–¥—Ä–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userAddress);
                
                // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Ç–∏
                const network = await provider.getNetwork();
                console.log('–¢–µ–∫—É—â–∞—è —Å–µ—Ç—å:', network);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏
                if (network.chainId !== 11155111 && network.chainId !== 1) {
                    showNotification('‚ö†Ô∏è –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ Ethereum Mainnet –∏–ª–∏ Sepolia Testnet', 'error');
                    await switchToSepolia();
                    return;
                }
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                updateWalletUI(network);
                await loadWalletData();
                
                // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
                window.ethereum.on('chainChanged', () => {
                    console.log('–°–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∞, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞...');
                    location.reload();
                });
                
                window.ethereum.on('accountsChanged', (accounts) => {
                    console.log('–ê–∫–∫–∞—É–Ω—Ç –∏–∑–º–µ–Ω—ë–Ω:', accounts);
                    if (accounts.length === 0) {
                        location.reload();
                    } else {
                        location.reload();
                    }
                });
                
                isConnected = true;
                showNotification('‚úÖ –ö–æ—à–µ–ª—ë–∫ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω!', 'success');
                document.getElementById('connectWarning').style.display = 'none';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error);
                
                if (error.code === 4001) {
                    showNotification('‚ùå –í—ã –æ—Ç–∫–ª–æ–Ω–∏–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ', 'error');
                } else if (error.code === -32603 || error.message.includes('No active wallet')) {
                    showNotification('‚ùå MetaMask –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω! –û—Ç–∫—Ä–æ–π—Ç–µ MetaMask, –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.', 'error');
                } else {
                    showNotification('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
                }
                
                btn.disabled = false;
                btn.textContent = '–ü–æ–¥–∫–ª—é—á–∏—Ç—å MetaMask';
            }
        }
        
        async function switchToSepolia() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0xaa36a7' }], // Sepolia
                });
                location.reload();
            } catch (switchError) {
                if (switchError.code === 4902) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: '0xaa36a7',
                                chainName: 'Sepolia Testnet',
                                nativeCurrency: {
                                    name: 'SepoliaETH',
                                    symbol: 'ETH',
                                    decimals: 18
                                },
                                rpcUrls: ['https://sepolia.infura.io/v3/'],
                                blockExplorerUrls: ['https://sepolia.etherscan.io']
                            }],
                        });
                        location.reload();
                    } catch (addError) {
                        console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ç–∏:', addError);
                    }
                }
            }
        }
        
        function updateWalletUI(network) {
            // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            document.getElementById('connectBtn').style.display = 'none';
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ—à–µ–ª—å–∫–µ
            const walletInfo = document.getElementById('walletInfo');
            walletInfo.classList.add('connected');
            
            // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∞–¥—Ä–µ—Å
            const shortAddress = userAddress.slice(0, 6) + '...' + userAddress.slice(-4);
            document.getElementById('walletAddress').textContent = shortAddress;
            
            // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–µ—Ç—å
            const networkName = network.chainId === 1 ? 'üü¢ Mainnet' : 
                               network.chainId === 11155111 ? 'üü¢ Sepolia' : 
                               'üî¥ Unknown';
            document.getElementById('networkBadge').textContent = networkName;
        }
        
        async function loadWalletData() {
            try {
                // –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å ETH
                const balance = await provider.getBalance(userAddress);
                const ethBalance = ethers.utils.formatEther(balance);
                document.getElementById('walletBalance').textContent = 
                    `${parseFloat(ethBalance).toFixed(4)} ETH`;
                
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
                // –î–ª—è –¥–µ–º–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                document.getElementById('userBalance').textContent = '1,234.56';
                document.getElementById('usdValue').textContent = '$1.23';
                document.getElementById('stakedAmount').textContent = '500.00';
                document.getElementById('rewardsEarned').textContent = '12.50';
                document.getElementById('totalStaked').textContent = '50,000';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }
        
        // ==========================================
        // TEST FUNCTIONS
        // ==========================================
        function setMaxAmount() {
            if (!isConnected) {
                showNotification('‚ùå –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫!', 'error');
                return;
            }
            document.getElementById('stakeAmount').value = '1000';
            showNotification('‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ', 'success');
        }
        
        function testApprove() {
            if (!isConnected) {
                showNotification('‚ùå –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫!', 'error');
                return;
            }
            
            const amount = document.getElementById('stakeAmount').value;
            if (!amount || parseFloat(amount) <= 0) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É!', 'error');
                return;
            }
            
            showNotification('‚è≥ –°–∏–º—É–ª—è—Ü–∏—è Approve...', 'info');
            
            setTimeout(() => {
                showNotification('‚úÖ Approve –≤—ã–ø–æ–ª–Ω–µ–Ω! (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)', 'success');
            }, 2000);
        }
        
        function testStake() {
            if (!isConnected) {
                showNotification('‚ùå –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫!', 'error');
                return;
            }
            
            const amount = document.getElementById('stakeAmount').value;
            if (!amount || parseFloat(amount) <= 0) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É!', 'error');
                return;
            }
            
            showNotification('‚è≥ –°–∏–º—É–ª—è—Ü–∏—è Stake...', 'info');
            
            setTimeout(() => {
                const currentStaked = parseFloat(document.getElementById('stakedAmount').textContent);
                const newStaked = currentStaked + parseFloat(amount);
                document.getElementById('stakedAmount').textContent = newStaked.toFixed(2);
                document.getElementById('stakeAmount').value = '';
                showNotification('‚úÖ Stake –≤—ã–ø–æ–ª–Ω–µ–Ω! (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)', 'success');
            }, 2000);
        }
        
        function testUnstake() {
            if (!isConnected) {
                showNotification('‚ùå –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫!', 'error');
                return;
            }
            
            const amount = document.getElementById('stakeAmount').value;
            if (!amount || parseFloat(amount) <= 0) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É!', 'error');
                return;
            }
            
            showNotification('‚è≥ –°–∏–º—É–ª—è—Ü–∏—è Unstake...', 'info');
            
            setTimeout(() => {
                showNotification('‚úÖ Unstake –≤—ã–ø–æ–ª–Ω–µ–Ω! (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)', 'success');
            }, 2000);
        }
        
        function testClaim() {
            if (!isConnected) {
                showNotification('‚ùå –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫!', 'error');
                return;
            }
            
            showNotification('‚è≥ –°–∏–º—É–ª—è—Ü–∏—è Claim Rewards...', 'info');
            
            setTimeout(() => {
                showNotification('‚úÖ –ù–∞–≥—Ä–∞–¥—ã –ø–æ–ª—É—á–µ–Ω—ã! (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)', 'success');
            }, 2000);
        }
        
        // ==========================================
        // NOTIFICATIONS
        // ==========================================
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
        
        // ==========================================
        // INITIALIZATION
        // ==========================================
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ file://
            if (window.location.protocol === 'file:') {
                const warning = document.getElementById('connectWarning');
                warning.className = 'info-box error';
                warning.innerHTML = `
                    <strong>‚ö†Ô∏è –í–ê–ñ–ù–û: –§–∞–π–ª –æ—Ç–∫—Ä—ã—Ç –ª–æ–∫–∞–ª—å–Ω–æ (file://)</strong>
                    <p style="margin-top: 10px;">
                        MetaMask –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ–∞–π–ª–∞–º–∏, –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∏–∑-–∑–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
                    </p>
                    <p style="margin-top: 10px;"><strong>–†–µ—à–µ–Ω–∏—è:</strong></p>
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>Python:</strong> <code style="background: rgba(0,0,0,0.3); padding: 2px 8px; border-radius: 5px;">python -m http.server 8000</code> ‚Üí <a href="http://localhost:8000" target="_blank" style="color: var(--accent);">http://localhost:8000</a></li>
                        <li><strong>Node.js:</strong> <code style="background: rgba(0,0,0,0.3); padding: 2px 8px; border-radius: 5px;">npx http-server -p 8000</code> ‚Üí <a href="http://localhost:8000" target="_blank" style="color: var(--accent);">http://localhost:8000</a></li>
                        <li><strong>VS Code:</strong> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ "Live Server" ‚Üí –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ —Ñ–∞–π–ª–µ ‚Üí "Open with Live Server"</li>
                        <li><strong>Online:</strong> –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–∞ <a href="https://netlify.com/drop" target="_blank" style="color: var(--accent);">Netlify Drop</a> –∏–ª–∏ GitHub Pages</li>
                    </ol>
                    <p style="margin-top: 10px; color: var(--accent);">–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ MetaMask –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è –±–µ–∑ –ø—Ä–æ–±–ª–µ–º!</p>
                `;
                
                showNotification('‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ http:// –∏–ª–∏ https:// –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å MetaMask', 'error');
                return;
            }
            
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫—É—Ä—Å USDT/RUB
            await fetchUsdtRubRate();
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ MetaMask
            if (typeof window.ethereum !== 'undefined') {
                console.log('MetaMask –æ–±–Ω–∞—Ä—É–∂–µ–Ω!');
            } else {
                console.log('MetaMask –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
            }
        });
    </script>
</body>
</html>
